<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Venue Demographics - 30A Florida</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0D0D0D;
      color: #FFFFFF;
      min-height: 100vh;
    }

    /* Navigation */
    .navbar {
      background: #111;
      padding: 0 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 60px;
      border-bottom: 1px solid #333;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
      font-weight: 700;
      color: white;
      text-decoration: none;
    }

    .nav-brand span {
      background: #3B82F6;
      color: white;
      padding: 3px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-link {
      color: #aaa;
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .nav-link:hover {
      color: white;
      background: #222;
    }

    .nav-link.btn-primary {
      background: #6366F1;
      color: white;
    }

    .nav-link.btn-primary:hover {
      background: #5558E3;
    }

    .nav-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #10B981;
    }

    .nav-status .dot {
      width: 8px;
      height: 8px;
      background: #10B981;
      border-radius: 50%;
    }

    .nav-status.error {
      color: #EF4444;
    }

    .nav-status.error .dot {
      background: #EF4444;
    }
    
    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 1fr 360px;
      height: calc(100vh - 60px);
    }
    
    @media (max-width: 900px) {
      .main-content {
        grid-template-columns: 1fr;
        height: auto;
      }
    }
    
    #map {
      width: 100%;
      height: 100%;
      min-height: 500px;
      background: #e8e8e8;
    }
    
    .sidebar {
      background: #1a1a1a;
      padding: 20px;
      overflow-y: auto;
      border-left: 1px solid #333;
    }
    
    .section {
      margin-bottom: 24px;
    }
    
    .section h2 {
      font-size: 13px;
      color: #6366F1;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .venue-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .venue-card {
      background: #252525;
      padding: 14px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid transparent;
    }
    
    .venue-card:hover {
      background: #2a2a2a;
      border-color: #6366F1;
    }
    
    .venue-card.active {
      border-color: #6366F1;
      background: #2a2a3a;
    }
    
    .venue-name {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 15px;
    }
    
    .venue-meta {
      font-size: 12px;
      color: #888;
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .category-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 4px;
      font-size: 11px;
      text-transform: uppercase;
      font-weight: 600;
      color: white;
    }
    
    .category-bar { background: #7C3AED; }
    .category-restaurant { background: #F59E0B; }
    .category-cafe { background: #10B981; }
    .category-brewery { background: #EF4444; }
    .category-club { background: #EC4899; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .stat-card {
      background: #252525;
      padding: 16px;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: bold;
      color: #6366F1;
    }
    
    .stat-label {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
    }
    
    .privacy-badge {
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(135deg, #1a2a1a 0%, #1a3a2a 100%);
      border: 1px solid #10B981;
      padding: 14px;
      border-radius: 8px;
      font-size: 13px;
    }
    
    .privacy-badge .icon {
      color: #10B981;
      font-size: 24px;
    }

    .privacy-badge strong {
      color: #10B981;
    }

    .privacy-badge small {
      color: #6EE7B7;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #888;
    }
    
    .leaflet-popup-content-wrapper {
      background: #1a1a1a;
      color: white;
      border-radius: 8px;
    }
    
    .leaflet-popup-tip {
      background: #1a1a1a;
    }
    
    .popup-content h3 {
      margin-bottom: 8px;
      color: white;
    }
    
    .popup-content p {
      font-size: 12px;
      color: #ccc;
      margin: 4px 0;
    }

    .empty-state {
      text-align: center;
      padding: 30px;
      color: #666;
    }

    /* Modal Styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #1a1a1a;
      border-radius: 12px;
      max-width: 480px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid #333;
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #333;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 20px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: #888;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .modal-close:hover {
      color: white;
    }

    .modal-body {
      padding: 24px;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-size: 13px;
      color: #aaa;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 14px;
      background: #252525;
      border: 1px solid #333;
      border-radius: 6px;
      color: white;
      font-size: 14px;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #6366F1;
    }

    .form-group select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23888' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }

    .btn-primary {
      background: #6366F1;
      color: white;
    }

    .btn-primary:hover {
      background: #5558E3;
    }

    .btn-primary:disabled {
      background: #444;
      cursor: not-allowed;
    }

    .form-note {
      font-size: 12px;
      color: #666;
      margin-top: 16px;
      text-align: center;
    }

    .form-success {
      text-align: center;
      padding: 20px;
    }

    .form-success .success-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .form-success h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: #10B981;
    }

    .form-success p {
      color: #888;
      font-size: 14px;
    }

    /* About Content */
    .about-content h3 {
      font-size: 18px;
      margin-bottom: 12px;
      color: white;
    }

    .about-content p {
      color: #aaa;
      font-size: 14px;
      line-height: 1.7;
      margin-bottom: 16px;
    }

    .about-features {
      list-style: none;
      margin: 20px 0;
    }

    .about-features li {
      padding: 12px 0;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      color: #ccc;
      border-bottom: 1px solid #333;
    }

    .about-features li:last-child {
      border-bottom: none;
    }

    .about-features .feature-icon {
      font-size: 20px;
    }

    .about-features strong {
      display: block;
      color: white;
      margin-bottom: 4px;
    }

    .about-features small {
      color: #888;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <a href="#" class="nav-brand">
      Venue Demographics
      <span>30A</span>
    </a>
    <div class="nav-links">
      <div id="apiStatus" class="nav-status">
        <div class="dot"></div>
        <span>Connecting...</span>
      </div>
      <a href="#" class="nav-link" onclick="openModal('aboutModal')">About</a>
      <a href="#" class="nav-link btn-primary" onclick="openModal('signupModal')">Sign Up</a>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <div id="map"></div>
    
    <div class="sidebar">
      <div class="section">
        <div class="privacy-badge">
          <div class="icon">üîí</div>
          <div>
            <strong>Privacy Mode Active</strong><br>
            <small>K-anonymity: 10+ visitors required</small>
          </div>
        </div>
      </div>
      
      <div class="section">
        <h2>Stats</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="venueCount">-</div>
            <div class="stat-label">Venues</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="categoryCount">-</div>
            <div class="stat-label">Categories</div>
          </div>
        </div>
      </div>
      
      <div class="section">
        <h2>Nearby Venues</h2>
        <div id="venueList" class="venue-list">
          <div class="loading">Loading venues...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal" class="modal-overlay" onclick="closeModalOnOverlay(event)">
    <div class="modal">
      <div class="modal-header">
        <h2>About Venue Demographics</h2>
        <button class="modal-close" onclick="closeModal('aboutModal')">√ó</button>
      </div>
      <div class="modal-body about-content">
        <p>Venue Demographics helps you discover the vibe at local bars, restaurants, and cafes ‚Äî all while protecting everyone's privacy.</p>
        
        <ul class="about-features">
          <li>
            <span class="feature-icon">üë•</span>
            <div>
              <strong>Real-time Crowd Insights</strong>
              <small>See age ranges and gender distribution at venues near you</small>
            </div>
          </li>
          <li>
            <span class="feature-icon">üîí</span>
            <div>
              <strong>Privacy First</strong>
              <small>K-anonymity ensures no individual can be identified. Data only shows when 10+ visitors are present.</small>
            </div>
          </li>
          <li>
            <span class="feature-icon">üìç</span>
            <div>
              <strong>Polygon Geofencing</strong>
              <small>Precise venue boundaries ‚Äî not just a point on a map</small>
            </div>
          </li>
          <li>
            <span class="feature-icon">‚úÖ</span>
            <div>
              <strong>GDPR and CCPA Compliant</strong>
              <small>Built from the ground up with privacy regulations in mind</small>
            </div>
          </li>
        </ul>

        <p style="color: #666; font-size: 13px;">Currently available in the 30A Florida area. More locations coming soon!</p>
      </div>
    </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" class="modal-overlay" onclick="closeModalOnOverlay(event)">
    <div class="modal">
      <div class="modal-header">
        <h2>Create Account</h2>
        <button class="modal-close" onclick="closeModal('signupModal')">√ó</button>
      </div>
      <div class="modal-body">
        <div id="signupForm">
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" id="signupEmail" placeholder="you@example.com" required>
          </div>
          
          <div class="form-group">
            <label>Confirm Email</label>
            <input type="email" id="confirmEmail" placeholder="Confirm your email" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Age Range</label>
              <select id="signupAge" required>
                <option value="">Select...</option>
                <option value="18-24">18-24</option>
                <option value="25-34">25-34</option>
                <option value="35-44">35-44</option>
                <option value="45-54">45-54</option>
                <option value="55-64">55-64</option>
                <option value="65+">65+</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Gender</label>
              <select id="signupGender" required>
                <option value="">Select...</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
                <option value="non-binary">Non-binary</option>
                <option value="prefer-not">Prefer not to say</option>
              </select>
            </div>
          </div>
          
          <button class="btn btn-primary" onclick="handleSignup()">Create Account</button>
          
          <p class="form-note">Your demographic info helps power anonymous venue insights. We never share individual data.</p>
        </div>

        <div id="signupSuccess" class="form-success" style="display: none;">
          <div class="success-icon">‚úÖ</div>
          <h3>You are all set!</h3>
          <p>Check your email for a verification link to complete your signup.</p>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const API_BASE = 'https://venue-demographics-api-production.up.railway.app/v1';
    const CENTER = [30.3205, -86.1435];
    
    let map;
    let markers = [];
    let venues = [];
    
    const categoryColors = {
      bar: '#7C3AED',
      restaurant: '#F59E0B',
      cafe: '#10B981',
      brewery: '#EF4444',
      club: '#EC4899'
    };

    // Modal functions
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
      document.body.style.overflow = '';
    }

    function closeModalOnOverlay(event) {
      if (event.target.classList.contains('modal-overlay')) {
        event.target.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    // Signup handler
    function handleSignup() {
      const email = document.getElementById('signupEmail').value.trim();
      const confirmEmail = document.getElementById('confirmEmail').value.trim();
      const age = document.getElementById('signupAge').value;
      const gender = document.getElementById('signupGender').value;

      // Validation
      if (!email || !confirmEmail || !age || !gender) {
        alert('Please fill in all fields');
        return;
      }

      if (email !== confirmEmail) {
        alert('Email addresses do not match');
        return;
      }

      if (!email.includes('@') || !email.includes('.')) {
        alert('Please enter a valid email address');
        return;
      }

      // In production, send to backend
      console.log('Signup:', { email, age, gender });

      // Show success
      document.getElementById('signupForm').style.display = 'none';
      document.getElementById('signupSuccess').style.display = 'block';
    }
    
    function initMap() {
      map = L.map('map').setView(CENTER, 12);
      
      // Lighter map style - CARTO Voyager
      L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        attribution: '¬© OpenStreetMap ¬© CARTO',
        maxZoom: 19
      }).addTo(map);
    }
    
    async function checkHealth() {
      const statusEl = document.getElementById('apiStatus');
      try {
        const res = await fetch(API_BASE + '/health');
        const data = await res.json();
        
        if (data.status === 'healthy') {
          statusEl.innerHTML = '<div class="dot"></div><span>Connected</span>';
          statusEl.classList.remove('error');
          return true;
        }
      } catch (err) {
        console.error(err);
      }
      statusEl.innerHTML = '<div class="dot"></div><span>Offline</span>';
      statusEl.classList.add('error');
      return false;
    }
    
    async function loadVenues() {
      try {
        const url = API_BASE + '/venues/nearby?lat=' + CENTER[0] + '&lng=' + CENTER[1] + '&radius=10000';
        const res = await fetch(url);
        const data = await res.json();
        
        if (data.success && data.data && data.data.venues) {
          venues = data.data.venues;
          displayVenues(venues);
          
          document.getElementById('venueCount').textContent = venues.length;
          const categories = [...new Set(venues.map(function(v) { return v.category; }))];
          document.getElementById('categoryCount').textContent = categories.length;
        } else {
          document.getElementById('venueList').innerHTML = 
            '<div class="empty-state"><p>No venues found</p></div>';
        }
      } catch (err) {
        document.getElementById('venueList').innerHTML = 
          '<div class="empty-state"><p>Failed to load venues</p></div>';
      }
    }
    
    function displayVenues(venueList) {
      markers.forEach(function(m) { map.removeLayer(m); });
      markers = [];
      
      venueList.forEach(function(venue, index) {
        const color = categoryColors[venue.category] || '#6366F1';
        
        const icon = L.divIcon({
          className: 'custom-marker',
          html: '<div style="background:' + color + ';width:28px;height:28px;border-radius:50%;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.4);"></div>',
          iconSize: [28, 28],
          iconAnchor: [14, 14]
        });
        
        const marker = L.marker([venue.latitude, venue.longitude], { icon: icon })
          .addTo(map)
          .bindPopup(
            '<div class="popup-content">' +
            '<h3>' + venue.name + '</h3>' +
            '<p><strong>Category:</strong> ' + venue.category + '</p>' +
            '<p><strong>Address:</strong> ' + (venue.address || 'N/A') + '</p>' +
            '</div>'
          );
        
        marker.on('click', function() { selectVenue(index); });
        markers.push(marker);
      });
      
      if (venueList.length === 0) {
        document.getElementById('venueList').innerHTML = 
          '<div class="empty-state"><p>No venues found</p></div>';
        return;
      }

      let listHtml = '';
      venueList.forEach(function(venue, index) {
        const distanceKm = (venue.distance / 1000).toFixed(1);
        listHtml += '<div class="venue-card" onclick="selectVenue(' + index + ')" id="venue-' + index + '">' +
          '<div class="venue-name">' + venue.name + '</div>' +
          '<div class="venue-meta">' +
          '<span class="category-badge category-' + venue.category + '">' + venue.category + '</span>' +
          '<span>' + distanceKm + ' km away</span>' +
          '</div></div>';
      });
      
      document.getElementById('venueList').innerHTML = listHtml;
      
      if (markers.length > 0) {
        const group = L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
      }
    }
    
    function selectVenue(index) {
      document.querySelectorAll('.venue-card').forEach(function(card) { 
        card.classList.remove('active'); 
      });
      document.getElementById('venue-' + index).classList.add('active');
      
      const venue = venues[index];
      map.setView([venue.latitude, venue.longitude], 15);
      markers[index].openPopup();
    }
    
    window.selectVenue = selectVenue;

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(function(modal) {
          modal.classList.remove('active');
        });
        document.body.style.overflow = '';
      }
    });
    
    window.onload = function() {
      initMap();
      checkHealth().then(function() { loadVenues(); });
    };
  </script>
</body>
</html>
